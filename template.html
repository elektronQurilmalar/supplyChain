<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Mouser)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 2em; background-color: #f9f9f9; }
        h1, h2 { color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        table { border-collapse: collapse; width: 100%; box-shadow: 0 2px 8px rgba(0,0,0,0.1); background-color: white; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; vertical-align: top; }
        th { background-color: #f2f2f2; font-weight: bold; }
        .risk-low { background-color: #e8f5e9; }
        .risk-medium { background-color: #fff3e0; }
        .risk-high { background-color: #ffebee; }
        .risk-critical { background-color: #ffcdd2; font-weight: bold; }
        .risk-not-found { background-color: #eceff1; color: #607d8b; }
        .part-number { font-family: "Courier New", Courier, monospace; font-weight: bold; }
        .summary { padding: 15px; background-color: #e3f2fd; border-left: 5px solid #2196f3; margin-bottom: 20px; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ —Å –∑–∞–º–µ–Ω–∞–º–∏ */
        .replacement-box {
            background-color: #fafafa;
            border-top: 2px solid #e0e0e0;
            padding: 15px;
            margin-top: -1px; /* –ß—Ç–æ–±—ã –ø–µ—Ä–µ–∫—Ä—ã—Ç—å –Ω–∏–∂–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É —è—á–µ–π–∫–∏ */
        }
        .replacement-box h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #1a237e;
            font-size: 1.1em;
        }
        .replacement-item {
            font-size: 0.9em;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 8px;
            margin-bottom: 8px;
        }
        .replacement-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .replacement-item b {
            color: #0d47a1;
        }
    </style>
</head>
<body>
    <h1>–ê–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–æ–≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ (BOM)</h1>
    <p>–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: <strong>Mouser API</strong></p>
    <div class="summary">
        <h2>–°–≤–æ–¥–∫–∞ –ø–æ —Ä–∏—Å–∫–∞–º</h2>
        <ul>
            {% for level, count in summary.items() %}
                {% if count > 0 %}
                    <li><strong>{{ level }}:</strong> {{ count }} –ø–æ–∑.</li>
                {% endif %}
            {% endfor %}
        </ul>
    </div>

    <h2>–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h2>
    <table>
        <thead>
            <tr>
                <th style="width:15%;">–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞</th>
                <th style="width:20%;">Part Number</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ (BOM) / –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å</th>
                <th style="width:12%;">–ù–∞–ª–∏—á–∏–µ (—à—Ç)</th>
                <th style="width:15%;">–°—Ç–∞—Ç—É—Å</th>
            </tr>
        </thead>
        <tbody>
            {% for item in components %}
            <tr class="{{ item.risk_class }}">
                <td><b>{{ item.risk_level }}</b></td>
                <td class="part-number">{{ item.PartNumber }}</td>
                <td>{{ item.Description }}<br><small style="color:gray;">{{ item.manufacturer }}</small></td>
                <td>{{ item.stock }}</td>
                <td>{{ item.lifecycle_status }}</td>
            </tr>

            {% if item.replacements %}
            <tr>
                <td colspan="5" style="padding: 0; border: 0;">
                    <div class="replacement-box">
                        <h4>üí° –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–º–µ–Ω—ã:</h4>
                        {% for rep in item.replacements %}
                        <div class="replacement-item">
                            <b>{{ rep.part_number }}</b> ({{ rep.manufacturer }})<br>
                            <i>{{ rep.description }}</i><br>
                            <span style="color: green; font-weight: bold;">–í –Ω–∞–ª–∏—á–∏–∏: {{ rep.stock }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </td>
            </tr>
            {% endif %}

            {% endfor %}
        </tbody>
    </table>
    <p style="text-align:center; color: #aaa; margin-top: 20px;">–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: {{ report_date }}</p>
</body>
</html>